@import "tailwindcss";
@import "./codemirror.css";
@import "./hljs.css";

/* ============================================================
   Theme Tokens — Dark (default) & Light mode
   Toggle via data-theme="light" on <html>.
   ============================================================ */

:root {
  /* ── Surfaces (warm dark) ── */
  --color-app: #151310;
  --color-sidebar: #1a1714;
  --color-surface: #201d19;
  --color-elevated: #272420;
  --color-hover: #2e2b26;
  --color-active: #38342e;

  /* ── Borders ── */
  --color-border-subtle: rgba(220, 205, 180, 0.06);
  --color-border-default: rgba(220, 205, 180, 0.10);
  --color-border-strong: rgba(220, 205, 180, 0.18);

  /* ── Text ── */
  --color-text-primary: #e8dcc8;
  --color-text-secondary: #bfb49e;
  --color-text-muted: #8a7e6e;
  --color-text-accent: #c49a3c;

  /* ── Accent (warm gold) ── */
  --color-accent: #c49a3c;
  --color-accent-hover: #d4a94a;
  --color-accent-muted: rgba(196, 154, 60, 0.12);

  /* ── Semantic ── */
  --color-success: #6dba5e;
  --color-warning: #daa030;
  --color-error: #d4604e;

  /* ── Block (slightly warm cards) ── */
  --color-block-bg: rgba(30, 27, 23, 0.85);
  --color-block-border: rgba(220, 205, 180, 0.06);
  --color-block-selected: rgba(196, 154, 60, 0.45);

  /* ── Scrollbar ── */
  --scrollbar-thumb: rgba(220, 205, 180, 0.10);
  --scrollbar-thumb-hover: rgba(220, 205, 180, 0.18);

  /* ── Connectors ── */
  --color-connector: rgba(220, 205, 180, 0.25);
  --color-connector-hover: rgba(196, 154, 60, 0.6);

  /* ── Overlays ── */
  --overlay-2: rgba(220, 205, 180, 0.02);
  --overlay-4: rgba(220, 205, 180, 0.04);
  --overlay-5: rgba(220, 205, 180, 0.05);
  --overlay-6: rgba(220, 205, 180, 0.06);
  --overlay-8: rgba(220, 205, 180, 0.08);
  --overlay-10: rgba(220, 205, 180, 0.10);
  --overlay-15: rgba(220, 205, 180, 0.14);
  --overlay-20: rgba(220, 205, 180, 0.18);
  --overlay-35: rgba(220, 205, 180, 0.32);
  --overlay-40: rgba(220, 205, 180, 0.38);
  --overlay-45: rgba(220, 205, 180, 0.42);
  --overlay-70: rgba(220, 205, 180, 0.65);
  --overlay-85: rgba(220, 205, 180, 0.80);

  /* ── Panel glass ── */
  --panel-bg: rgba(26, 23, 20, 0.85);
  --panel-border: rgba(220, 205, 180, 0.08);
  --panel-shadow: 0 4px 24px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(220, 205, 180, 0.04);

  /* ── Block shadows ── */
  --block-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
  --block-shadow-selected: 0 0 0 2px rgba(196, 154, 60, 0.45), 0 4px 16px rgba(0, 0, 0, 0.35);
  --block-shadow-editing: 0 0 0 2px rgba(196, 154, 60, 0.35), 0 8px 28px rgba(0, 0, 0, 0.5);

  /* ── Backdrop ── */
  --backdrop-bg: rgba(0, 0, 0, 0.45);
}

:root[data-theme="light"] {
  /* ── Surfaces (matte paper — low glare) ── */
  --color-app: #e9e3d9;
  --color-sidebar: #e2dcd2;
  --color-surface: #dbd5cb;
  --color-elevated: #f0ece6;
  --color-hover: #d5cfc5;
  --color-active: #cec8be;

  /* ── Borders ── */
  --color-border-subtle: rgba(60, 45, 30, 0.07);
  --color-border-default: rgba(60, 45, 30, 0.12);
  --color-border-strong: rgba(60, 45, 30, 0.22);

  /* ── Text ── */
  --color-text-primary: #2c2418;
  --color-text-secondary: #5a4e3e;
  --color-text-muted: #8a7e6e;
  --color-text-accent: #8b6914;

  /* ── Accent (warm gold) ── */
  --color-accent: #a07818;
  --color-accent-hover: #8b6914;
  --color-accent-muted: rgba(139, 105, 20, 0.10);

  /* ── Semantic ── */
  --color-success: #4a8a3c;
  --color-warning: #b88a20;
  --color-error: #b04430;

  /* ── Block ── */
  --color-block-bg: rgba(240, 236, 230, 0.92);
  --color-block-border: rgba(60, 45, 30, 0.08);
  --color-block-selected: rgba(139, 105, 20, 0.40);

  /* ── Scrollbar ── */
  --scrollbar-thumb: rgba(60, 45, 30, 0.1);
  --scrollbar-thumb-hover: rgba(60, 45, 30, 0.18);

  /* ── Connectors ── */
  --color-connector: rgba(60, 45, 30, 0.18);
  --color-connector-hover: rgba(139, 105, 20, 0.5);

  /* ── Overlays ── */
  --overlay-2: rgba(60, 45, 30, 0.02);
  --overlay-4: rgba(60, 45, 30, 0.03);
  --overlay-5: rgba(60, 45, 30, 0.04);
  --overlay-6: rgba(60, 45, 30, 0.05);
  --overlay-8: rgba(60, 45, 30, 0.06);
  --overlay-10: rgba(60, 45, 30, 0.07);
  --overlay-15: rgba(60, 45, 30, 0.09);
  --overlay-20: rgba(60, 45, 30, 0.12);
  --overlay-35: rgba(60, 45, 30, 0.35);
  --overlay-40: rgba(60, 45, 30, 0.40);
  --overlay-45: rgba(60, 45, 30, 0.45);
  --overlay-70: rgba(60, 45, 30, 0.62);
  --overlay-85: rgba(60, 45, 30, 0.75);

  /* ── Panel glass ── */
  --panel-bg: rgba(235, 230, 222, 0.88);
  --panel-border: rgba(60, 45, 30, 0.10);
  --panel-shadow: 0 2px 12px rgba(60, 45, 30, 0.06), 0 0 0 1px rgba(60, 45, 30, 0.04);

  /* ── Block shadows ── */
  --block-shadow: 0 1px 4px rgba(60, 45, 30, 0.06);
  --block-shadow-selected: 0 0 0 2px rgba(139, 105, 20, 0.40), 0 2px 8px rgba(60, 45, 30, 0.06);
  --block-shadow-editing: 0 0 0 2px rgba(139, 105, 20, 0.35), 0 4px 14px rgba(60, 45, 30, 0.08);

  /* ── Backdrop ── */
  --backdrop-bg: rgba(0, 0, 0, 0.2);
}

/* Tailwind v4 utility generation — references the root variables */
@theme {
  --color-app: var(--color-app);
  --color-sidebar: var(--color-sidebar);
  --color-surface: var(--color-surface);
  --color-elevated: var(--color-elevated);
  --color-hover: var(--color-hover);
  --color-active: var(--color-active);

  --color-border-subtle: var(--color-border-subtle);
  --color-border-default: var(--color-border-default);
  --color-border-strong: var(--color-border-strong);

  --color-text-primary: var(--color-text-primary);
  --color-text-secondary: var(--color-text-secondary);
  --color-text-muted: var(--color-text-muted);
  --color-text-accent: var(--color-text-accent);

  --color-accent: var(--color-accent);
  --color-accent-hover: var(--color-accent-hover);
  --color-accent-muted: var(--color-accent-muted);

  --color-success: var(--color-success);
  --color-warning: var(--color-warning);
  --color-error: var(--color-error);

  --color-block-bg: var(--color-block-bg);
  --color-block-border: var(--color-block-border);
  --color-block-selected: var(--color-block-selected);

  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'JetBrains Mono', 'Menlo', monospace;

  --spacing-sidebar: 260px;
  --spacing-toolbar: 48px;

  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 14px;
}

/* ============================================================
   Base — resets that can't be utilities
   ============================================================ */

/* Latin Modern Roman (modern LaTeX default) — for markdown blocks */
@font-face {
  font-family: 'Latin Modern Roman';
  src: url('../assets/fonts/lmroman10-regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Latin Modern Roman';
  src: url('../assets/fonts/lmroman10-bold.woff2') format('woff2');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Latin Modern Roman';
  src: url('../assets/fonts/lmroman10-italic.woff2') format('woff2');
  font-weight: 400;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: 'Latin Modern Roman';
  src: url('../assets/fonts/lmroman10-bolditalic.woff2') format('woff2');
  font-weight: 700;
  font-style: italic;
  font-display: swap;
}

/* CMU Serif Upright Italic — for headings (special "italic but upright" cut) */
@font-face {
  font-family: 'CMU Serif Upright Italic';
  src: url('../assets/fonts/cmu-serif-upright-italic-500-roman.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@layer base {

  *,
  *::before,
  *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-size: 13px;
    /* overridden by JS inline style for sketchy mode */
    @apply w-full h-full overflow-hidden;
  }

  body,
  #root {
    @apply w-full h-full overflow-hidden bg-app text-text-primary font-sans text-base leading-normal antialiased select-none;
  }

  /* macOS titlebar drag area */
  body::before {
    content: '';
    @apply fixed top-0 left-0 right-0 h-[38px] z-[1000] pointer-events-none;
    -webkit-app-region: drag;
  }

  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 3px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }
}

/* ============================================================
   Global component styles — truly shared rules that don't
   belong to any single component (canvas, cursors, connectors,
   block containment, third-party overrides)
   ============================================================ */

@layer components {

  /* Canvas cursor states — toggled via JS classList */
  .panning {
    cursor: grabbing;
  }

  .cursor-crosshair {
    cursor: crosshair;
  }

  .cursor-move {
    cursor: move;
  }

  /* Chevron rotation — needs parent selector */
  .notebook-header.expanded .notebook-chevron {
    transform: rotate(90deg);
  }

  /* xterm overrides — can't control internal classes */
  .xterm-viewport {
    overflow-y: hidden !important;
  }

  /* Canvas drawing layer — GPU compositing hint for WebKit */
  .drawing-canvas {
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    image-rendering: auto;
  }

  /* Block content — layout containment prevents repaint propagation during drag/resize.
     Using `layout style paint` instead of `content` to avoid size containment,
     which causes the browser to intermittently drop the layout during state transitions
     (e.g. loading → rendered), resulting in a visible flicker. */
  .block-content {
    contain: layout style paint;
  }

  /* Blocks — promote to compositor layer to prevent repaint flash during
     React state transitions (loading → content). */
  [data-role="block"] {
    will-change: transform;
  }

  /* SVG connector styling — must use CSS for SVG attributes */
  .connector-path {
    fill: none;
    stroke: var(--color-connector);
    stroke-width: 2;
    pointer-events: stroke;
    cursor: pointer;
    transition: stroke 120ms ease;
  }

  .connector-path:hover {
    stroke: var(--color-connector-hover);
    stroke-width: 2.5;
  }

  .connector-arrowhead {
    fill: var(--color-connector);
  }

}